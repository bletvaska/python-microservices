# Jinja2 Templates

## Co je to sablonovaci system?

príklad mechanizmu pomocou f-reťazcov


## Jinja2

Jinja2 je veľmi populárny. Síce vychádza zo šablónovacieho systému, ktorý používa webový rámec Django, ale ten sa nedá použiť samostatne. Naopak - šablónovací systém Jinja2 používa mnoho ďalších nástrojov/knižníc:

* webové rámce - dá sa integrovať zrejme do väčšiny z nich, ako napr. do rámcov Flask, FastAPI, ...
* Ansible
* Salt


## Inštalácia

Balík so šablónovacím systémom Jinja2 je už nainštalovaný, pretože ho používa samotný Apache Airflow. Ak by ste ho však chceli používať pre svoje vlastné projekty, nainštalujete ho nasledovným príkazom:

```bash
# ak pouzivame poetry
$ poetry add jinja2

# ak pouzivame len pip
$ pip install jinja2
```


## Základy použitia

Začneme tým, že importujeme modul jinja2:

```python
>>> import jinja2
```

Hlavným komponent modulu je trieda Environment. Obsahuje rozličné zdieľané premenné, ako konfiguráciu, filtre a iné. Budeme ju používať na tvorbu šablón.

Začneme tým, že vytvoríme inštanciu triedy `Environment` bez parametrov:

```python
>>> env = jinja2.Environment()
```

Šablóna je vlastne reťazec, ktorý je veľmi podobný f-reťazcu. Rozdielom je, že miesto uzatvorenia premennej do jedných zložených zátvoriek túto premennú uzatvoríme do dvojitých. Jednoduchú šablónu vytvoríme takto:

```python
>>> template = env.from_string('Hello, {{ name }}!')
```

Nakoniec necháme šablónu vyrenderovať pomocou metódy `.render()`:

```python
>>> template.render()
'Hello, !'
```

Šablóna však bola vyrenderovaná bez dát. Ak chceme do šablóny na miesto {{ name }} dosadiť hodnotu, urobíme to pomocou parametrov metódy .render() takto:

```python
>>> template.render(name='World')
'Hello, World!'
```


## Jinja2 a FastAPI

pripojime priecinok k endpointu `/static`. budeme ho pouzivat na staticke subory, ako JavaScript-ove skripty, kaskadne styly, obrazky a podobne:

```python
from pathlib import Path
from starlette.staticfiles import StaticFiles

app.mount("/static",
          StaticFiles(directory=Path(__file__).parent / "static"),
          name="static")
```

vyskusat to mozeme napriklad tak, ze si v prehliadaci alebo z prikazoveho riadku nechame zobrazit css subor, ktory sa v tom priecinku nachadza:

```bash
$ http http://localhost:8000/static/images/bitday.png
```

## dependencies

```python
@lru_cache
def get_templates() -> Jinja2Templates:
    return Jinja2Templates(directory=Path(__file__).parent / "templates")
```



## Práca so šablónami uloženými v súbore

Práca so šablónovacími systémami reprezentuje vzor MVC:

* model - údaje
* view - šablóna
* controller - fragment kódu, ktorý spojí údaje so šablónou


### Šablóna

Vytvoríme súbor `weather.tpl.j2` a vložíme do neho tento obsah:

```python
Weather for {{ city }} on {{ date }}.

Max temperature: {{ max_temp }}{{ temp_unit }}
Min temperature: {{ min_temp }}{{ temp_unit }}
Average temperature: {{ avg_temp }}{{ temp_unit }}

---
Generated by Apache Airflow {{ timestamp }}.
```


### Nahratie šablóny zo súboru

Tentokrát vytvoríme objekt typu `Environment` s parametrami. Pomocou nich nastavíme priečinok, v ktorom bude Jinja vyhľadávať šablóny:

```python
>>> env = jinja2.Environment(
  loader=jinja2.FileSystemLoader('/path/to/templates'),
  autoescape=False
)
```

Pomocou metódy `.get_template()` načítame šablónu zo súboru zadaním jej názvu:

```python
>>> template = env.get_template('weather.tpl.j2')
```


## Vykreslenie šablóny s dátami
Nakoniec už len pripravíme údaje, ktoré budeme v šablóne renderovať. Uložíme ich do slovníka, kde kľúčom budú premenné použité v šablóne a hodnotou budú hodnoty, ktoré chceme zobraziť:

```python
>>> data = {
   "city": "Košice",
   "date": "2023-05-18"
}
```

Nakoniec šablónu vykreslíme:

```python
>>> print(template.render(data))
```

